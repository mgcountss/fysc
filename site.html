<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="./bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta charset="utf-8">
    <title>SFMGTube</title>
    <style>
        body {
            text-align: center;
            background-color: #222222;
            font-family: 'Open Sans', sans-serif;
        }

        ::placeholder {
            color: #FFFFFF;
            opacity: 1;
        }

        :-ms-input-placeholder {
            color: #FFFFFF;
            ;
        }

        ::-ms-input-placeholder {
            color: #FFFFFF;
            ;
        }

        .random {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            text-align: center;
        }

        .pop,
        .new {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            text-align: center;
        }

        a,
        a:hover {
            color: #FFF;
        }

        #bell:hover {
            cursor: pointer;
        }

        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        li {
            float: left;
            cursor: pointer;
        }

        li a {
            display: block;
            color: white;
            text-align: center;
            padding: 1vw 1vw;
            text-decoration: none;
        }

        hr {
            background-color: #FFF;
        }

        .sideItem {
            color: #FFF;
            font-size: 1.5vw;
            font-weight: 600;
            background-color: #333;
            border-radius: 0.7vw;
            width: 15vw;
            padding-top: 0.3vw;
            padding-bottom: 0.3vw;
            margin-top: 0vw;
            margin-bottom: 0vw;
            margin-left: 0.6vw;
        }

        .loaded {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            grid-gap: 1vw;
            margin-top: 1vw;
            margin-bottom: 1vw;
        }
    </style>
</head>

<body>
    <ul>
        <li><a href="/" style="font-size: 1.5vw; font-weight: 600;">SFMGTube</a></li>
        <li><input class="form-control mr-sm-2" id="search" placeholder="Search"
                style="margin-top: 0.7vw; height: 3vw; width: 100%;"></li>
        <li style="margin-top: 0.7vw; margin-left: 0vw;"><button
                style="color: #FFF; height: 3vw; width: 7vw; box-sizing: border-box; display: inline-block; border-radius: 0.25rem; border: solid #FFF 0.1vw; background-color: #202020;"
                onclick="window.location.href = '/old'" style="margin-top: 2vw;">Search</button></li>
        <li style="float: right;">
            <div style="display: flex;">
                <i onclick="window.location.href = 'https://youtube.com/@sfmg/live'" id="upload" class="fa fa-upload"
                    aria-hidden="true" style="font-size: 2.5vw; margin-top: 1vw; width: 3vw;"></i>
                <a href="/edit"><img src="/default.png" class="edit" id="edit"
                        style="height: 2.5vw; width: 2.5vw; border-radius: 50%;"></a>
            </div>
        </li>
    </ul>
    <div style="width: 100%; display: grid; grid-template-columns: 1fr 5fr; font-size: 2vw; background-color: #141414;">
        <div style="border: solid 0.3vw #FFF;">
            <ul>
                <li class="sideItem" onclick="window.location.href = '/'">
                    Home
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/user?id='" id="profilePage">
                    Profile
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/old'">
                    Rankings
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/compare/search'">
                    Compare
                </li><br>
                <hr style="margin-top: 0vw; margin-bottom: 0vw;">
                <li class="sideItem" style="margin-top: 0vw;" onclick="window.location.href = '/?type=creators'">
                    Top Creators
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/?type=videos'">
                    Top Videos
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/?type=shorts'">
                    Top Shorts
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/?type=streams'">
                    Top Streams
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/?type=songs'">
                    Top Songs
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/?type=podcasts'">
                    Top Podcasts
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/?type=comments'">
                    Top Comments
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/?type=playlists'">
                    Top Playlists
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/?type=posts'">
                    Top Posts
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/?type=clans'">
                    Top Clans
                </li><br>
                <hr style="margin-top: 0vw; margin-bottom: 0vw;">
                <li class="sideItem" style="margin-top: 0vw;"
                    onclick="window.location.href = 'https://youtube.com/@SFMG/join'">
                    Membership
                </li><br>
                <li class="sideItem" onclick="window.location.href = '/stats'">
                    Statistics
                </li><br>
                <li class="sideItem" onclick="window.location.href = 'https://youtube.com/@SFMG/live'">
                    About
                </li>
            </ul>
        </div>
        <div>
            <h1 id="sort">Sort By: </h1>
            <select id="select">
                <option value="algorithm">Algorithm</option>
                <option value="posted">Posted</option>
                <option value="views">Views</option>
                <option value="likes">Likes</option>
                <option value="dislikes">Dislikes</option>
                <option value="comments">Comments</option>
            </select>
            <h1 style="margin-top: 1vw;">Order By: </h1>
            <select id="order">
                <option value="desc">Descending</option>
                <option value="asc">Ascending</option>
            </select>
            <hr>
            <div class="loaded" id="loaded"></div>
        </div>
    </div>
    <script src="./jquery.js"></script>
    <script src="./bootstrap.js"></script>
    <script>
        function search() {
            window.location.href = "/search/" + document.getElementById('search').value
        }
        function relativeTime(previous) {
            const date = new Date();
            const timestamp = date.getTime();
            previous = Math.floor(previous / 1000)
            const difference = Math.floor(timestamp / 1000) - previous;
            let output = ``;
            if (difference < 60) {
                if (difference === 1) {
                    output = `${difference} second ago`;
                } else {
                    output = `${difference} seconds ago`;
                }
            } else if (difference < 3600) {
                if (difference === 1) {
                    output = `${Math.floor(difference / 60)} minute ago`;
                } else {
                    output = `${Math.floor(difference / 60)} minutes ago`;
                }
            } else if (difference < 86400) {
                if (difference === 1) {
                    output = `${Math.floor(difference / 3600)} hour ago`;
                } else {
                    output = `${Math.floor(difference / 3600)} hours ago`;
                }
            } else if (difference < 2620800) {
                if (difference === 1) {
                    output = `${Math.floor(difference / 86400)} day ago`;
                } else {
                    output = `${Math.floor(difference / 86400)} days ago`;
                }
            } else if (difference < 31449600) {
                if (difference === 1) {
                    output = `${Math.floor(difference / 2620800)} month ago`;
                } else {
                    output = `${Math.floor(difference / 2620800)} months ago`;
                }
            } else {
                if (difference === 1) {
                    output = `${Math.floor(difference / 31449600)} year ago`;
                } else {
                    output = `${Math.floor(difference / 31449600)} years ago`;
                }
            }
            return output;
        }
        let sort = "";
        let type = "";
        let order = "";
        if (document.URL.split('&sort=')) {
            sort = document.URL.split('&sort=')[1]
        }
        if (document.URL.split('?type=')) {
            type = document.URL.split('?type=')[1]
        }
        if (!document.URL.split('?type=')[1]) {
            window.location.href = '/?type=videos'
        }
        if (document.URL.split('&order=')) {
            order = document.URL.split('&order=')[1]
        }
        if (!document.URL.split('&order=')[1]) {
            order = 'desc'
        }
        if (!document.URL.split('&sort=')[1]) {
            if ((type == "") || (type == "videos") || (type == "streams") || (type == "shorts") || (type == "songs") || (type == "podcasts")) {
                sort = 'algorithm'
            } else if ((type == "creators")) {
                sort = 'subs'
            } else {
                sort = 'posted'
            }
        }
        if (sort.includes('&')) {
            sort = sort.split('&')[0]
        } else if (sort.includes('?')) {
            sort = sort.split('?')[0]
        }
        if (type.includes('&')) {
            type = type.split('&')[0]
        } else if (type.includes('?')) {
            type = type.split('?')[0]
        }
        if (order.includes('&')) {
            order = order.split('&')[0]
        } else if (order.includes('?')) {
            order = order.split('?')[0]
        }
        if (order == 'desc') {
            document.getElementById('order').value = 'desc'
        } else {
            document.getElementById('order').value = 'asc'
        }
        fetch('/site/' + type + '?sort=' + sort + '&order=' + order).then(res => res.json()).then(data => {
            for (let i = 0; i < data.uploads.length; i++) {
                let card = document.createElement('div')
                if ((type == 'comments') || (type == 'posts')) {
                    let thing = 'replies'
                    if (type == 'posts') {
                        thing = 'comments'
                    }
                    card.style = "width: 40vw; text-align: left; padding-left: 0.3vw; padding-right: 0.3vw;"
                    card.innerHTML = `<div>
                            <div style="text-align: left; padding: 0vw; display: flex;">
                                <a href="/videos/${data.uploads[i].contentID.replace('_', '!')}">
                                    <img src="${data.uploads[i].ownerImage}"
                                        style="border-radius: 50%; float: left; margin-right: 1vw;">
                                </a>
                                <div>
                                    <a href="/user?id=${data.uploads[i].ownerID}">
                                        <div style="display: flex; align-items: center;">
                                            <h2
                                                style="color: #FFF; font-size: 1.5vw; font-weight: bolder; text-overflow: ellipsis;">
                                                ${data.uploads[i].owner}
                                            </h2>
                                            <h5
                                                style="color: #FFF; margin-top: 0vw; margin-left: 0vw; text-overflow: ellipsis; overflow: hidden;">
                                                · ${relativeTime(data.uploads[i].posted)}
                                            </h5>
                                        </div>
                                    </a>
                                    <h2 style="color: #FFF; font-size: 1.7vw; margin-top: 0vw;">
                                        ${data.uploads[i].title}
                                    </h2>
                                    <div style="display: flex; gap: 1vw;">
                                        <div style="display: flex; align-items: center;"><i
                                                class="fa fa-thumbs-up" style="font-size: 2vw; margin"></i>
                                            <h2 style="font-size: 1.5vw; margin-left: 0.4vw; margin-top: 0.5vw;">
                                                ${data.uploads[i].likes.toLocaleString()}
                                            </h2>
                                        </div>
                                        <div style="display: flex; align-items: center;">
                                            <i class="fa fa-reply" style="font-size: 2vw;"></i>
                                            <h2 style="font-size: 1.5vw; margin-left: 0.4vw; margin-top: 0.5vw;">
                                                ${data.uploads[i][thing].toLocaleString()}
                                            </h2>
                                        </div>
                                    </div>
                                    <div style="padding-top: 10px; display: none;">
                                        <input class="form-control" placeholder="Add A Reply" id="reply_comment"
                                            style="font-size: 15px; width: 30%;">
                                        <button
                                            style="border: solid #FFF; font-size: 15px; color: #000; background-color: #000;">Reply</button>
                                    </div>
                                </div>
                            </div>
                            <hr>
                        </div>`
                    document.getElementById('loaded').style.gridTemplateColumns = "repeat(auto-fill, minmax(40vw, 1fr))"
                } else if (type == 'creators') {
                    if (!data.uploads[i].created) {
                        data.uploads[i].created = new Date().getTime()
                    }
                    card.style = "width: 40vw; text-align: left; padding-left: 0.3vw; padding-right: 0.3vw;"
                    card.innerHTML = `<div>
                            <div style="text-align: left; padding: 0vw; display: flex;">
                                <a href="/user?id=${data.uploads[i].cid}">
                                    <img src="${data.uploads[i].image}"
                                        style="border-radius: 50%; float: left; margin-right: 1vw;">
                                </a>
                                <div>
                                    <a href="/user?id=${data.uploads[i].cid}">
                                        <div style="display: flex; align-items: center;">
                                            <h2
                                                style="color: #FFF; font-size: 1.5vw; font-weight: bolder; text-overflow: ellipsis;">
                                                ${data.uploads[i].name}
                                            </h2>
                                            <h5
                                                style="color: #FFF; margin-top: 0vw; margin-left: 0vw; text-overflow: ellipsis; overflow: hidden;">
                                                · ${relativeTime(data.uploads[i].lastMSG)}
                                            </h5>
                                        </div>
                                    </a>
                                    <h2 style="color: #FFF; font-size: 1.7vw; margin-top: 0vw;">
                                        ${Math.floor(data.uploads[i][data.sort]).toLocaleString()} ${data.sort}
                                    </h2>
                                    <div style="padding-top: 10px; display: none;">
                                        <input class="form-control" placeholder="Add A Reply" id="reply_comment"
                                            style="font-size: 15px; width: 30%;">
                                        <button
                                            style="border: solid #FFF; font-size: 15px; color: #000; background-color: #000;">Reply</button>
                                    </div>
                                </div>
                            </div>
                            <hr>
                        </div>`
                    document.getElementById('loaded').style.gridTemplateColumns = "repeat(auto-fill, minmax(40vw, 1fr))"
                } else {
                    let image = `<img style="border: solid #FFF; height: 9vw; width: 100%; margin-top: 0vw; object-fit: cover;" src="/thumbnail/${data.uploads[i].id}">`
                    card.style = "width: 19vw; text-align: left; padding-left: 0.3vw; padding-right: 0.3vw;"
                    if ((data.type == 'shorts')) {
                        image = `<img style="border: solid #FFF; height: 100%; width: 9vw; height: 16vw; object-fit: cover;" src="/thumbnail/${data.uploads[i].id}">`
                        card.style = "width: 19vw; text-align: left; padding-bottom: 4vw; padding-right: 0vw; padding-left: 0vw;"
                    } else if (data.type == 'podcasts' || data.type == 'playlists') {
                        image = `<img style="border: solid #FFF; height: 9vw; width: 9vw; object-fit: cover;" src="${data.uploads[i].ownerImage}">`
                    }
                    let thing = 'views'
                    if ((data.sort != 'algorithm') && (data.sort != 'posted')) {
                        thing = data.sort
                    }
                    data.uploads[i][thing] = Math.floor(data.uploads[i][thing]).toLocaleString()
                    card.innerHTML = `
                    <a href="/videos/${data.uploads[i].id}!${data.uploads[i].ownerID}">
                        ${image}
                        <h1
                            style="max-width: 24vw; font-size: 1.5vw; font-weight: bold; text-overflow: clip; overflow: hidden; white-space: nowrap;">
                            ${data.uploads[i].title}
                        </h1>
                    </a><a href="/user?id=${data.uploads[i].ownerID}">
                        <img style="margin-top: -0.5vw; border-radius: 50%; height: 2.5vw; width: 2.5vw; float: left;" src="${data.uploads[i].ownerImage}">
                        <div style="margin-top: -0.3vw;">
                        <h6
                            style="max-width: 24vw; text-overflow: clip; overflow: hidden; white-space: nowrap; font-size: 1vw; font-weight: bold;">
                           ${data.uploads[i].owner}
                        </h6>
                        <h6
                            style="max-width: 24vw; text-overflow: clip; overflow: hidden; white-space: nowrap; font-size: 1vw; margin-top: -0.6vw;">
                            ${data.uploads[i][thing]} ${thing} •
                            ${relativeTime(data.uploads[i].posted)}
                        </h6>
                        </div>
                    </a>`
                }
                document.getElementById('loaded').appendChild(card)
                document.getElementById('select').innerHTML = []
                for (let i = 0; i < data.select.length; i++) {
                    data.select[i] = (data.select[i][0].toUpperCase() + data.select[i].slice(1))
                    let option = document.createElement('option')
                    option.value = data.select[i]
                    option.innerHTML = data.select[i]
                    document.getElementById('select').appendChild(option)
                    document.getElementById('select').value = sort[0].toUpperCase() + sort.slice(1)
                    document.getElementById('sort').innerHTML = "Sort " + data.type[0].toUpperCase() + data.type.slice(1) + " By"
                }
            }
        })
   
        if (localStorage.getItem('token')) {
            fetch('/me', {
                headers: {
                    'Authorization': localStorage.getItem('token')
                }
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('edit').src = data.user.image
                    document.getElementById('profilePage').onclick = () => {
                        window.location.href = '/user?id=' + data.id
                    }
                })
        }

        document.getElementById('select').addEventListener('change', () => {
            window.location.href = window.location.href.split('&')[0] + '&sort=' + document.getElementById('select').value.toLowerCase()+"&order="+document.getElementById('order').value
        });

        document.getElementById('order').addEventListener('change', () => {
            window.location.href = window.location.href.split('&')[0] + '&sort=' + document.getElementById('select').value.toLowerCase()+"&order="+document.getElementById('order').value
        });

        if (type == 'clans') {
            fetch('/api/clans')
            .then(res => res.json())
            .then(data=> {
                let str = ``;
                data = data.sort((a, b) => b.subs - a.subs)
                for (let q = 0; q < data.length; q++) {
                    let membersDivs = [];
                    for (let i = 0; i < data[q].members.length; i++) {
                        let member = data[q].users.find(x => x.cid == data[q].members[i])
                        membersDivs.push(`<a href="/user?id=${member.cid}">
                            <img src="${member.image}"
                                style="border-radius: 50%; float: left; margin-right: 0.3vw; margin-top: 0.3vw; height: 1vw; width: 1vw;">
                                <p style="color: #FFF; font-size: 1vw; margin-bottom: 0vw; margin-left: 0vw; text-overflow: ellipsis; overflow: hidden;">${member.name}</p>
                                <p style="color: #FFF; font-size: 1vw; margin-top: 0vw; margin-left: 0vw; text-overflow: ellipsis; overflow: hidden;">${Math.floor(member.subs).toLocaleString()} Subs</p>
                        </a>`)
                    }
                    let div = document.createElement('div');
                    div.style = "width: 40vw; text-align: left; padding-left: 0.3vw; padding-right: 0.3vw; border: solid 0.1vw "+(data[q].color || "#FFF") +";"
                    div.innerHTML = `<div>
                        <div style="text-align: left; padding: 0vw;">
                            <a href="/user?id=${data[q].leader} style="height: 0.5vw; width: 0.5vw;">
                                <img src="${data[q].users.find(x => x.cid == data[q].leader).image}"
                                    style="border-radius: 50%; float: left; margin-right: 1vw;">
                            </a>
                            <div>
                                <a href="/user?id=${data[q].leader}">
                                    <div style="display: flex; align-items: center;">
                                        <h2
                                            style="color: #FFF; font-size: 1.5vw; font-weight: bolder; text-overflow: ellipsis;">
                                            ${data[q].name+" "}
                                        </h2>
                                        <h5
                                            style="color: #FFF; margin-top: 0vw; margin-left: 0vw; text-overflow: ellipsis; overflow: hidden;">
                                            · ${data[q].members.length} Members
                                        </h5>
                                    </div>
                                </a>
                            </div>
                            <div>
                                <h2 style="color: #FFF; font-size: 1.7vw; margin-top: 0vw;">
                                    ${Math.floor(data[q].subs).toLocaleString()} Subscribers
                                </h2><hr>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr;">
                                    ${membersDivs.join('')}
                                </div>
                            </div>
                        </div>
                        <hr>
                    </div>`
                    document.getElementById('loaded').appendChild(div)
                    document.getElementById('loaded').style.gridTemplateColumns = "repeat(auto-fill, minmax(40vw, 1fr))"
                }
            })
        }
    </script>
</body>

</html>